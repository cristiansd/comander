<?phprequire_once('../Connections/conexionComanderEnvCam.php');require_once('../includes/funcionesEnvCam.php');if (!isset($_SESSION)) {    session_start();}$MM_authorizedUsers = "3,2,1";$MM_donotCheckaccess = "false";include '../includes/restriccionCam.php';$idUsuario = recuperaUsuario($_SESSION['MM_Username']);mysqli_select_db($comcon, $database_comcon);$query_notify = "SELECT * FROM notificaciones WHERE leidoNotificaciones=0 AND (idCamareroNotificaciones IS NULL OR idCamareroNotificaciones=".$idUsuario.") ORDER BY tiempoNotificaciones DESC";$notify = mysqli_query($comcon, $query_notify) or die(mysqli_connect_error());$row_notify = mysqli_fetch_assoc($notify);$totalRows_notify = mysqli_num_rows($notify);?><!DOCTYPE html><html>    <head>        <meta charset="utf-8">        <title>Consultar notificaciones</title>        <script type="text/javascript" src="jquery-mobile/jquery.js"></script>        <style type="text/css">                       .userselect {                -webkit-user-select: none;  /* Chrome all / Safari all */                -moz-user-select: none;     /* Firefox all */                -ms-user-select: none;      /* IE 10+ */                user-select: none;          /* Likely future */                  }                        .toast {                width:200px;                height:20px;                height:auto;                position:absolute;                left:50%;                margin-left:-100px;                bottom:140px;                background-color: #383838;                color: #F0F0F0;                font-family: Calibri;                font-size: 20px;                padding:10px;                text-align:center;                border-radius: 5px;                -webkit-box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);                -moz-box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);                box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);            }                        .switch {                position: relative;                display: inline-block;                width: 60px;                height: 34px;            }            .switch input {                display:none;            }            .slider {                position: absolute;                cursor: pointer;                top: 0;                left: 0;                right: 0;                bottom: 0;                background-color: #ccc;                -webkit-transition: .4s;                transition: .4s;            }            .slider:before {                position: absolute;                content: "";                height: 26px;                width: 26px;                left: 4px;                bottom: 4px;                background-color: white;                -webkit-transition: .4s;                transition: .4s;            }            input:checked + .slider {                background-color: #2196F3;            }            input:focus + .slider {                box-shadow: 0 0 1px #2196F3;            }            input:checked + .slider:before {                -webkit-transform: translateX(26px);                -ms-transform: translateX(26px);                transform: translateX(26px);            }            .slider.round {                border-radius: 34px;            }            .slider.round:before {                border-radius: 50%;            }        </style>        <meta name="viewport" content="width=device-width, initial-scale=1">        <!--<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">-->        <link rel="stylesheet" href="../estilos/w3.css">        <link rel="stylesheet" href="../estilos/w3-theme-indigo.css">        <!--<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->        <link rel="stylesheet" href="..\font-awesome-4.7.0\css\font-awesome.min.css">        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">        <script type="text/javascript" src="js/location.js"></script>        <script type="text/javascript">                        var notifyglobal = "";                        $(window).load(function () {                $("#progress").css("display","none");                $("#textonav").html("MENSAJES");                $("#textonav").css({'margin-left':'15px'});                var medida = $( window ).height() - 100;                $("#pant").css("height",medida-30);                recuperaEstado();            });                        function recarga(){                setInterval(function(){ $("#pant").load(location.href + " #pant"); },1000);            }                        function recuperaEstado() {                $.ajax({                    type: "POST",                    async: true,                    url: "recuperarEstadoNotificacion.php",                    success: function (data) {                        if (data === '1'){                            document.getElementById("switch1").checked = true;                            //$('#switch1').attr('checked', true);                        }else{                            document.getElementById("switch1").checked = false;                            //$('#switch1').attr('checked', false);                        }                       }                });            }                        function borrarNotificacion(idNotificacion){                $("#progress").css("display","block");                var borrar = {'idNotificacion': idNotificacion};                $.ajax({                    type: "POST",                    async: true,                    url: "borrarNotificacion.php",                    data: borrar,                    success: function (data) {                        $("#progress").css("display","none");                        if (data === "OK") {                            $('.toast').text('Notificacion atendida');                            $('.toast').fadeIn(300).delay(1000).fadeOut(300);                            $("#pant").load(location.href + " #pant");                        } else {                            $('.toast').text('Error al eliminar');                            $('.toast').fadeIn(400).delay(2000).fadeOut(400);                        }                    }                });                       }                        function atenderNotificacion(idNotificacion, usuarioNotificacion, tipoNotificacion, mesa, pedido){                console.log(idNotificacion + ' / ' + usuarioNotificacion + ' / '  + tipoNotificacion + ' / '  + mesa + ' / '  + pedido + ' / ' )                switch(tipoNotificacion) {                    case 1:                        location.href='cobrarAutoEnvCam.php?idUsuarioNotificaciones=' + usuarioNotificacion + '&idMesa=' + mesa + '&idNotificacion=' + idNotificacion;                        break;                    case 2:                        location.href='cobrarAutoEnvCam.php?idUsuarioNotificaciones=' + usuarioNotificacion + '&idMesa=' + mesa + '&idNotificacion=' + idNotificacion;                        break;                    case 4:                        borrarNotificacion(idNotificacion);                        location.href = 'listaTiempoRealEnvCam.php?idMesa=' + mesa + '&idPedido=' + pedido;                        break;                    case 5:                        location.href='gestionMesasEnvCam.php?idnotificacion=' + idNotificacion;                        break;                    case 6:                        location.href='consultarPreparadosEnvCam.php?idNotificacion=' + idNotificacion;;                        break;                    default:                        document.getElementById('id01').style.display = 'block';                }                        }                        function borrar(){                borrarNotificacion(notifyglobal);                document.getElementById('id01').style.display = 'none';            }                                    function cambio(){                var estado;                if(document.getElementById("switch1").checked === true){                    estado = 1;                }else{                    estado = 0;                }                var est = {'estado': estado};                $.ajax({                    type: "POST",                    url: "actualizarEstadoNotificacion.php",                    data: est,                    success: function (dato) {                        if (dato === "OK") {                            $('.toast').text('Estado actualizado');                        }else{                            $('.toast').text('Error al actualizar');                        }                        $('.toast').fadeIn(400).delay(2000).fadeOut(400);                    }                });            }        </script>    </head>    <body class="w3-light-grey" onload="recarga();">        <div class="w3-padding w3-display-middle" id="progress"><img src="page-loader.gif" width="100px" height="100px"></div>        <div class="userselect">            <?php include '../includes/menuNavegacionsinbuscar.html'; ?>            <br><br><br>            <div id="pant" style="overflow-y: scroll;">                <?php if ($totalRows_notify > 0) { ?>                    <ul class="w3-ul w3" style="margin-top: 20px;">                        <div style="border-bottom: #706e6e solid 1px;"></div>                        <?php do {                            if ($row_notify['tipoNotificacion'] !== NULL){$tipo = $row_notify['tipoNotificacion'];}else{$tipo = 0;}                            if ($row_notify['idPedido'] !== NULL){$pedido = $row_notify['idPedido'];}else{$pedido = 0;}?>                        <li class=" w3-hover-light-blue" style="border-bottom: #706e6e solid 1px;" onclick="notifyglobal=<?php echo $row_notify['idNotificaciones'] ?>;atenderNotificacion(<?php echo $row_notify['idNotificaciones']; ?>, <?php echo $row_notify['idUsuarioNotificaciones']; ?>, <?php echo $tipo; ?>, <?php echo $row_notify['idMesaNotificaciones']; ?>, <?php echo $pedido; ?>);">                            <div class="" style="width: 30%;float: left;">MESA <?php if ($row_notify['idMesaNotificaciones'] != NULL){echo recuperaNombreMesa($row_notify['idMesaNotificaciones']);} ?></div>                            <div style="width: 70%;float: right;text-align: right;padding-right: 5px;"><?php echo date_format(date_create($row_notify['tiempoNotificaciones']),"H:i:s"); ?></div>                            <div><?php echo"- " . $row_notify['mensajeNotificaciones']; ?></div>                        </li>                            <hr style="margin: 0px">                        <?php } while ($row_notify = mysqli_fetch_assoc($notify)); ?>                    </ul>                <?php } else { ?>                    <div>                        <div class="w3-container w3-section w3-theme-l2 w3-center">                            <h3>TODAS LAS NOTIFICACIONES ESTAN ATENDIDAS</h3>                        </div>                    </div>                <?php } ?>            </div>        </div>                <div class='toast' style='display:none'>TOAST</div>                <div id="id01" class="w3-modal">            <div class="w3-container w3-section w3-yellow w3-center">                <span onclick="document.getElementById('id01').style.display = 'none';" class="w3-closebtn">&times;</span>                <h3>¡ATENCION!</h3>                <div><b>¿SE HA ATENDIDO LA NOTIFICACION?</b></div>                <div class="w3-margin-top w3-margin-bottom w3-center">                    <button class="w3-btn w3-indigo w3-small" style="width:30%;margin-right: 5px;"  id="" onclick="borrar()">SI</button>                    <button class="w3-btn w3-indigo w3-small" style="width:30%;margin-left: 5px;" id="" onclick="document.getElementById('id01').style.display = 'none';">NO</button>                </div>            </div>        </div>                <footer class="w3-bottom w3-theme">            <div style="margin-top: 10px;margin-bottom: 5px;padding-left: 30px;" class="w3-left">                <label class="switch">                    <input type="checkbox" id="switch1" name="switch1" onchange="cambio();">                    <div class="slider round"></div>                </label>            </div>            <div style="margin-top: 15px;padding-right: 30px;" class="w3-right">RECIBIR NOTIFICACIONES</div>        </footer>    </body></html><?phpmysqli_free_result($Mesas);?>