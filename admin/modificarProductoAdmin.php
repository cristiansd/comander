<?phprequire_once('../includes/funcionesAdmin.php');require_once ('../includes/GoogleTranslate.php');if (!isset($_SESSION)) {  session_start();}$MM_authorizedUsers = "1,2,3";$MM_donotCheckaccess = "false";$MM_restrictGoTo = "accesoUsuarioAdmin.php";if (!((isset($_SESSION['MM_Username'])) && (isAuthorized("",$MM_authorizedUsers, $_SESSION['MM_Username'], $_SESSION['MM_UserGroup'])))) {     $MM_qsChar = "?";  $MM_referrer = $_SERVER['PHP_SELF'];  if (strpos($MM_restrictGoTo, "?")) $MM_qsChar = "&";  if (isset($_SERVER['QUERY_STRING']) && strlen($_SERVER['QUERY_STRING']) > 0)   $MM_referrer .= "?" . $_SERVER['QUERY_STRING'];  $MM_restrictGoTo = $MM_restrictGoTo. $MM_qsChar . "accesscheck=" . urlencode($MM_referrer);  header("Location: ". $MM_restrictGoTo);   exit;}$editFormAction = $_SERVER['PHP_SELF'];if (isset($_SERVER['QUERY_STRING'])) {  $editFormAction .= "?" . htmlentities($_SERVER['QUERY_STRING']);  }  //DECLARAMOS LA CONEXION A LA BASE DE DATOS    mysqli_select_db($conexionComanderAdmin, $database_conexionComanderAdmin);    $varCategoria_consultaCategoria = "0";if (isset($_GET["RecordID"])) {  $varProducto_consultaProducto = $_GET["RecordID"];}mysqli_select_db($conexionComanderAdmin, $database_conexionComanderAdmin);$query_consultaProducto = sprintf("SELECT * FROM productos WHERE idProducto=%s", GetSQLValueString($varProducto_consultaProducto , "int"));$consultaProducto = mysqli_query($conexionComanderAdmin, $query_consultaProducto) or die(mysqli_error($conexionComanderAdmin));$row_consultaProducto = mysqli_fetch_assoc($consultaProducto);$totalRows_consultaProducto = mysqli_num_rows($consultaProducto);//Aqui haremos consulta a la BD mediante funcion$RowConsultaCategoria=ConsultaRowsBD("categorias","idCategoria","");$consultaCategoria=ConsultaBD("categorias","idCategoria","");$RowConsultaSubcategorias=ConsultaRowsBD("subcategorias","idSubcategoria","");$consultaSubcategorias=ConsultaBD("subcategorias","idSubcategoria","");/*$RowConsultaZonas=ConsultaRowsBD("zonas","idZona","");$consultaZonas=ConsultaBD("zonas","idZona","");*///HACEMOS CONSULTA DE A LA BD DE LAS ZONAS$consulta_zonas = "SELECT * FROM zonas";$query_zonas = mysqli_query($conexionComanderAdmin, $consulta_zonas) or die (mysqli_error($conexionComanderAdmin));$RowConsultaZonas = mysqli_fetch_array($query_zonas);$total_rows_zonas = mysqli_num_rows($query_zonas);//HACEMOS CONSULTA DE LA ZONA SELECCIONADA$consulta_zona_seleccionada = "SELECT * FROM zonas WHERE idZona = '$zonaEnvioProducto'";$query_zonaEnvio = mysqli_query($conexionComanderAdmin, $consulta_zona_seleccionada) or die (mysqli_error($conexionComanderAdmin));$row_consulta_zonaEnvio = mysqli_fetch_array($query_zonaEnvio);//SETEAMOS LAS VARIABLES NECESARIAS$envioProducto = $id_imagen = $row_consultaProducto['id_imagen'];$id_string_producto = $row_consultaProducto['id_string'];$idProducto = $row_consultaProducto['idProducto'];$idStringDescripcion = $row_consultaProducto['id_string_descripcion'];$idAlergenos = $row_consultaProducto['id_string_alergenos'];$idNutricional = $row_consultaProducto['id_string_nutricional'];$imagen = $row_consultaProducto['imagenProducto'];$zonaEnvioProducto = $row_consultaProducto['envioProducto'];        if ($_POST['subirBtn']) {    if ($_FILES['imagen']['type'] == "image/jpeg" || $_FILES['imagen']['type'] == "image/png") {        if ($_FILES['imagen']['size'] <= 16777215) {//SUBIMOS IMAGEN A BASE DE DATOS            $imagen_temporal  = $_FILES['imagen']['tmp_name'];                        //este es el tipo de archivo            $tipo = $_FILES['imagen']['type'];                        //leer el archivo temporal en binario            $fp = fopen($imagen_temporal, 'r+b');            $data = fread($fp, filesize($imagen_temporal));            fclose($fp);            //escapar los caracteres            $data = mysqli_escape_string($conexionComanderAdmin, $data);//COMPROBAMOS SI TIENE IMAGEN            if($id_imagen != 0){                $query_images = "UPDATE imagenes SET imagen='$data', tipo_imagen='$tipo' WHERE id = '$id_imagen'";                mysqli_query($conexionComanderAdmin, $query_images)or die(mysqli_error($conexionComanderAdmin)) ;                $imagen = $_FILES['imagen']['name'];            } else {                $query_images = "INSERT INTO imagenes (imagen, tipo_imagen) VALUES ('$data', '$tipo')";                mysqli_query($conexionComanderAdmin, $query_images)or die(mysqli_error($conexionComanderAdmin)) ;                $imagen = $_FILES['imagen']['name'];                 //RECUPERAMOS EL ID DE LA IMAGEN                $consulta_imagen = "SELECT id FROM imagenes ORDER BY id DESC";                $query_imagen = mysqli_query($conexionComanderAdmin, $consulta_imagen);                $row_imagen = mysqli_fetch_array($query_imagen);                $id_imagen = $row_imagen['0'];            }        }       }        }if ((isset($_POST["MM_update"])) && ($_POST["MM_update"] == "form1")) {    //TRADUCIMOS A LOS DIFERENTES IDIOMAS         $traslator = new GoogleTranslate();        for ($i=0;$i<10;$i++){        switch ($i){            case 0:                $source = $_COOKIE['idioma'];                $target = 'en';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $inglesCategoria = $resultado;                break;            case 1:                $source = $_COOKIE['idioma'];                $target = 'ca';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $catalanCategoria = $resultado;                break;            case 2:                $source = $_COOKIE['idioma'];                $target = 'fr';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $francesCategoria = $resultado;                break;                  case 3:                $source = $_COOKIE['idioma'];                $target = 'de';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $alemanCategoria = $resultado;                break;            case 4:                $source = $_COOKIE['idioma'];                $target = 'it';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $italianoCategoria = $resultado;                break;               case 5:                $source = $_COOKIE['idioma'];                $target = 'ru';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $rusoCategoria = $resultado;                break;            case 6:                $source = $_COOKIE['idioma'];                $target = 'zh-CN';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $chinoCategoria = $resultado;                break;               case 7:                $source = $_COOKIE['idioma'];                $target = 'ja';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                $resultado = str_replace('"', '', $resultado);                $japonesCategoria = $resultado;                break;               case 8:                $source = $_COOKIE['idioma'];                $target = 'ar';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $arabeCategoria = $resultado;                break;              case 9:                $source = $_COOKIE['idioma'];                $target = 'es';                $text = $_POST['nombreProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $spanishCategoria = $resultado;                break;          }    }     //INSERTAMOS EN LA TABLA STRINGS EL NOMBRE DEL PRODUCTO EN DIFERENTE INDIOMAS    $insertNombre ="UPDATE strings SET spanish = '$spanishCategoria', ingles = '$inglesCategoria',"            . " catalan = '$catalanCategoria', frances = '$francesCategoria', aleman = '$alemanCategoria',"            . " italiano = '$italianoCategoria', ruso = '$rusoCategoria', chino = '$italianoCategoria',"            . " japones = '$japonesCategoria', arabe = '$arabeCategoria' WHERE id = '$id_string_producto'";        mysqli_query($conexionComanderAdmin, $insertNombre) or die(mysqli_error($conexionComanderAdmin));          $id_string_producto = $id_string_producto;    //COMPROBAMOS SI SE HA ENVIADO LA DESCRIPCION DEL PRODUCTOif(filter_input(INPUT_POST, 'descripcionProducto')){   for ($i=0;$i<10;$i++){        switch ($i){            case 0:                $source = $_COOKIE['idioma'];                $target = 'en';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $inglesProducto = $resultado;                break;            case 1:                $source = $_COOKIE['idioma'];                $target = 'ca';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $catalanProducto = $resultado;                break;            case 2:                $source = $_COOKIE['idioma'];                $target = 'fr';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $francesProducto = $resultado;                break;                  case 3:                $source = $_COOKIE['idioma'];                $target = 'de';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $alemanProducto = $resultado;                break;            case 4:                $source = $_COOKIE['idioma'];                $target = 'it';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $italianoProducto = $resultado;                break;               case 5:                $source = $_COOKIE['idioma'];                $target = 'ru';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $rusoProducto = $resultado;                break;            case 6:                $source = $_COOKIE['idioma'];                $target = 'zh-CN';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $chinoProducto = $resultado;                break;               case 7:                $source = $_COOKIE['idioma'];                $target = 'ja';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                $resultado = str_replace('"', '', $resultado);                $japonesProducto = $resultado;                break;               case 8:                $source = $_COOKIE['idioma'];                $target = 'ar';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $arabeProducto = $resultado;                break;              case 9:                $source = $_COOKIE['idioma'];                $target = 'es';                $text = $_POST['descripcionProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $spanishProducto = $resultado;                break;          }    } //COMPROBAMOS QUE EXISTE EL STRING DESCRIPCION EN LA TABLA PRODUCTO if ($idStringDescripcion =! null ){   $insertDescripcion = "UPDATE strings SET spanish='$spanishProducto', ingles='$inglesProducto', catalan='$catalanProducto', "           . "frances='$francesProducto', aleman='$alemanProducto', italiano='$italianoProducto', ruso='$rusoProducto', chino='$chinoProducto', "           . "japones='$japonesProducto', arabe='$arabeProducto' WHERE id='$idStringDescripcion'";    mysqli_query($conexionComanderAdmin, $insertDescripcion) or die(mysqli_error($conexionComanderAdmin));//PREPARAMOS LA SENTENCIA PARA RECUPERAR EL ID DE STRING DE DESCRIPCION   $id_string_descripcion = $idStringDescripcion;} else {       //INSERTAMOS EN LA TABLA STRINGS LA DESCRIPCION DEL PRODUCTO EN DIFERENTE INDIOMAS        $insertDescripcion = sprintf("INSERT INTO strings (spanish, ingles, catalan, frances, aleman, italiano, ruso, chino, japones, arabe) VALUES(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)",             GetSQLValueString($spanishProducto, "text"),             GetSQLValueString($inglesProducto, "text"),             GetSQLValueString($catalanProducto, "text"),             GetSQLValueString($francesProducto, "text"),            GetSQLValueString($alemanProducto, "text"),             GetSQLValueString($italianoProducto, "text"),            GetSQLValueString($rusoProducto, "text"),             GetSQLValueString($chinoProducto, "text"),            GetSQLValueString($japonesProducto, "text"),            GetSQLValueString($arabeProducto, "text"));      mysqli_query($conexionComanderAdmin, $insertDescripcion) or die(mysqli_error($conexionComanderAdmin));    //RECUPERAMOS EL ID DE STRING DE LA DESCRIPCION    $consultaString = "SELECT * FROM strings ORDER BY id DESC";    $query_String = mysqli_query($conexionComanderAdmin, $consultaString);    $row_string = mysqli_fetch_array($query_String);    $id_string_descripcion = $row_string['0'];} }else{    $id_string_descripcion = null;}//COMPROBAMOS SI SE HA ENVIADO ALERGENOS PRODUCTOif(filter_input(INPUT_POST, 'descripcionProducto')){        //TRADUCIMOS LA DESCRIPCION DE ALERGENOS A DIFERENTES IDIOMAS   for ($i=0;$i<10;$i++){        switch ($i){            case 0:                $source = $_COOKIE['idioma'];                $target = 'en';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $inglesAlergenos = $resultado;                break;            case 1:                $source = $_COOKIE['idioma'];                $target = 'ca';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $catalanAlergenos = $resultado;                break;            case 2:                $source = $_COOKIE['idioma'];                $target = 'fr';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $francesAlergenos = $resultado;                break;                  case 3:                $source = $_COOKIE['idioma'];                $target = 'de';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $alemanAlergenos = $resultado;                break;            case 4:                $source = $_COOKIE['idioma'];                $target = 'it';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $italianoAlergenos = $resultado;                break;               case 5:                $source = $_COOKIE['idioma'];                $target = 'ru';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $rusoAlergenos = $resultado;                break;            case 6:                $source = $_COOKIE['idioma'];                $target = 'zh-CN';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $chinoAlergenos = $resultado;                break;               case 7:                $source = $_COOKIE['idioma'];                $target = 'ja';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                $resultado = str_replace('"', '', $resultado);                $japonesAlergenos = $resultado;                break;               case 8:                $source = $_COOKIE['idioma'];                $target = 'ar';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $arabeAlergenos = $resultado;                break;              case 9:                $source = $_COOKIE['idioma'];                $target = 'es';                $text = $_POST['alergenosProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $spanishAlergenos = $resultado;                break;          }    }    //COMPROBAMOS QUE YA EXISTE EL ID ALERGENOS EN LA TABLA PRODUCTOS if ($idAlergenos != null){    $insertAlergenos = "UPDATE strings SET spanish='$spanishAlergenos', ingles='$inglesAlergenos', catalan='$catalanAlergenos', "            . "frances='$francesAlergenos', aleman='$alemanAlergenos', italiano='$italianoAlergenos', ruso='$rusoAlergenos', "            . "chino='$chinoAlergenos', japones='$japonesAlergenos', arabe='$arabeAlergenos' WHERE id = '$idAlergenos'";    mysqli_query($conexionComanderAdmin, $insertAlergenos) or die(mysqli_error($conexionComanderAdmin));    $id_string_alergenos = $idAlergenos;     } else {       //INSERTAMOS EN LA TABLA STRINGS LA DESCRIPCION DE ALERGENOS DEL PRODUCTO EN DIFERENTE INDIOMAS    $insertAlergenos = sprintf("INSERT INTO strings (spanish, ingles, catalan, frances, aleman, italiano, ruso, chino, japones, arabe) VALUES(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)",             GetSQLValueString($spanishAlergenos, "text"),             GetSQLValueString($inglesAlergenos, "text"),             GetSQLValueString($catalanAlergenos, "text"),             GetSQLValueString($francesAlergenos, "text"),            GetSQLValueString($alemanAlergenos, "text"),             GetSQLValueString($italianoAlergenos, "text"),            GetSQLValueString($rusoAlergenos, "text"),             GetSQLValueString($chinoAlergenos, "text"),            GetSQLValueString($japonesAlergenos, "text"),            GetSQLValueString($arabeAlergenos, "text"));        mysqli_query($conexionComanderAdmin, $insertAlergenos) or die(mysqli_error($conexionComanderAdmin));    //RECUPERAMOS EL ID DE STRING DE LA DESCRIPCION DE ALERGENOS    $consultaString = "SELECT * FROM strings ORDER BY id DESC";    $query_String = mysqli_query($conexionComanderAdmin, $consultaString);    $row_string = mysqli_fetch_array($query_String);    $id_string_alergenos = $row_string['0'];}}else{    $id_string_alergenos = null;}    //COMPROBAMOS QUE SE HA ENVIADO NUTRICIONAL PRODUCTOif(filter_input(INPUT_POST, 'nutricionalProducto')){//TRADUCIMOS LA DESCRIPCION DE NUTRICIONAL A DIFERENTES IDIOMAS   for ($i=0;$i<10;$i++){        switch ($i){            case 0:                $source = $_COOKIE['idioma'];                $target = 'en';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $inglesNutricional = $resultado;                break;            case 1:                $source = $_COOKIE['idioma'];                $target = 'ca';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $catalanNutricional = $resultado;                break;            case 2:                $source = $_COOKIE['idioma'];                $target = 'fr';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $francesNutricional = $resultado;                break;                  case 3:                $source = $_COOKIE['idioma'];                $target = 'de';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $alemanNutricional = $resultado;                break;            case 4:                $source = $_COOKIE['idioma'];                $target = 'it';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $italianoNutricional = $resultado;                break;               case 5:                $source = $_COOKIE['idioma'];                $target = 'ru';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $rusoNutricional = $resultado;                break;            case 6:                $source = $_COOKIE['idioma'];                $target = 'zh-CN';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                    $resultado = str_replace('"', '', $resultado);                $chinoNutricional = $resultado;                break;               case 7:                $source = $_COOKIE['idioma'];                $target = 'ja';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                $resultado = str_replace('"', '', $resultado);                $japonesNutricional = $resultado;                break;               case 8:                $source = $_COOKIE['idioma'];                $target = 'ar';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $arabeNutricional = $resultado;                break;              case 9:                $source = $_COOKIE['idioma'];                $target = 'es';                $text = $_POST['nutricionalProducto'];                $result = $traslator->translate($source, $target, $text);                $resultado = json_encode($result, JSON_UNESCAPED_UNICODE);                   $resultado = str_replace('"', '', $resultado);                $spanishNutricional = $resultado;                break;          }    } //COMPROBAMOS QUE EXISTA VALOR EN NUTRICIONAL PRODUCTOif ($idNutricional != null){    $insertNutricional = "UPDATE strings SET spanish='$spanishNutricional', ingles='$inglesNutricional', catalan='$catalanNutricional', "            . "frances='$francesNutricional', aleman='$alemanNutricional', italiano='$italianoNutricional', ruso='$rusoNutricional', "            . "chino='$chinoNutricional', japones='$japonesNutricional', arabe='$arabeNutricional' WHERE id='$idNutricional'";     mysqli_query($conexionComanderAdmin, $insertNutricional) or die(mysqli_error($conexionComanderAdmin));     $id_string_nutricional = $idNutricional;}//INSERTAMOS EN LA TABLA STRINGS LA DESCRIPCION NUTRICIONAL DEL PRODUCTO EN DIFERENTE INDIOMAS    $insertNutricional = sprintf("INSERT INTO strings (spanish, ingles, catalan, frances, aleman, italiano, ruso, chino, japones, arabe) VALUES(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)",             GetSQLValueString($spanishNutricional, "text"),             GetSQLValueString($inglesNutricional, "text"),             GetSQLValueString($catalanNutricional, "text"),             GetSQLValueString($francesNutricional, "text"),            GetSQLValueString($alemanNutricional, "text"),             GetSQLValueString($italianoNutricional, "text"),            GetSQLValueString($rusoNutricional, "text"),             GetSQLValueString($chinoNutricional, "text"),            GetSQLValueString($japonesNutricional, "text"),            GetSQLValueString($arabeNutricional, "text"));        mysqli_query($conexionComanderAdmin, $insertNutricional) or die(mysqli_error($conexionComanderAdmin));    //RECUPERAMOS EL ID DE STRING DE LA DESCRIPCION NUTRICIONAL    $consultaString = "SELECT * FROM strings ORDER BY id DESC";    $query_String = mysqli_query($conexionComanderAdmin, $consultaString);    $row_string = mysqli_fetch_array($query_String);    $id_string_nutricional = $row_string['0'];  }else{    $id_string_nutricional = null;}  //COMPROBAMOS SI SE HA AÃ‘ADIDO IMAGEN    if(filter_input(INPUT_POST, 'imagenProducto') != 'sinImagen.png'){     $nombreImagen = filter_input(INPUT_POST, 'imagenProducto');        }else{        $nombreImagen = "sinImagen.png";        $id_imagen = 0;    }            if(filter_input(INPUT_POST, 'precioCompraProducto' !=' ')){        $precioCompraProducto = filter_input(INPUT_POST, 'precioCompraProducto');    }else{        $precioCompraProducto = 'NULL';    }        if(filter_input(INPUT_POST, 'envioProducto')){        $zonaEnvioProducto = filter_input(INPUT_POST, 'envioProducto');    }      $updateSQL = sprintf("UPDATE productos SET nombreProducto=%s, id_string=%s, id_imagen=%s, idCategoriaProducto=%s, idSubcategoriaProducto=%s, "          . "imagenProducto=%s, precioVentaProducto=%s, precioCompraProducto=%s, estadoProducto=%s, stockProducto=%s, descripcionProducto=%s, "          . "envioProducto=%s, id_string_descripcion=%s, alergenosProducto=%s, id_string_alergenos=%s, nutricionalProducto=%s, "          . "id_string_nutricional=%s WHERE idProducto=%s",                        GetSQLValueString($_POST['nombreProducto'], "text"),                        GetSQLValueString($id_string_producto, "int"),                        GetSQLValueString($id_imagen, "int"),                        GetSQLValueString($_POST['idCategoriaProducto'], "int"),                        GetSQLValueString($_POST['idSubcategoriaProducto'], "int"),                        GetSQLValueString($nombreImagen, "text"),                        GetSQLValueString($_POST['precioVentaProducto'], "float"),                        GetSQLValueString($precioCompraProducto, "float"),                        GetSQLValueString($_POST['estadoProducto'], "int"),                          GetSQLValueString($_POST['stockProducto'], "int"),                        GetSQLValueString($_POST['descripcionProducto'], "text"),                        GetSQLValueString($zonaEnvioProducto, "int"),                        GetSQLValueString($id_string_descripcion, "int"),                        GetSQLValueString($_POST['alergenosProducto'], "text"),                        GetSQLValueString($id_string_alergenos, "int"),                        GetSQLValueString($_POST['nutricionalProducto'], "text"),                        GetSQLValueString($id_string_nutricional, "int"),                        GetSQLValueString($varProducto_consultaProducto, "int"));    mysqli_select_db($conexionComanderAdmin, $database_conexionComanderAdmin);  mysqli_query($conexionComanderAdmin, $updateSQL) or die(mysqli_error($conexionComanderAdmin));  $updateGoTo = "administracionProductosAdmin.php";    header("Location:".$updateGoTo);}?><!DOCTYPE html><html>    <head>        <meta charset="utf-8">        <link rel="stylesheet" href="../estilos/w3.css">        <link rel="stylesheet" href="../estilos/w3-theme-indigo.css">        <script type="text/javascript" src="../envCam/jquery-mobile/jquery.js"></script>        <link href="../estilos/admin.css" rel="stylesheet" type="text/css" />        <link href="../estilos/w3-theme-indigo.css" rel="stylesheet" type="text/css" />        <title><?php echo $titleSheet; ?></title>        <style type="text/css"></style>        <script type="text/javascript">            var height;            var width;            var nombreCategoria;            $(document).ready(function () {                height = $(window).height();                width = $(window).width();                var styleSidevar1 = "height:" + (height - 100) + "px;";                var styleFormulario = "margin-left:" + ((width - 500 - 240) / 2) + "px";                //$(".content").attr("style", styleSidevar1);                //$(".subcontenedor").attr("style", styleSidevar1);                if(height > $(".sidebar1").height()){                $(".sidebar1").attr("style", styleSidevar1);                                }                if($(".subcontenedor").height()>$(".sidebar1").height()){                    $(".sidebar1").attr("style", "height:" + $(".subcontenedor").height() + "px;");                                                }                $(".contenidoFormulario").attr("style", styleFormulario);                setImage();                $("#subirBtn").click(function(){                    nombreCategoria = $("#nombreCategoria").val();                    sessionStorage.setItem('nombreCategoria', nombreCategoria);                });            });//FUNCION PARA ELIMINAR EQITUETA CATEGORIA            function eliminarEtiqueta() {                $("#categoriaElemento").remove();            }            //FUNCION ASIGNAR VALOR A EL INPUT IMAGEN            function setImage(){                var image = "<?php echo $imagen; ?>";                if(typeof image !== 'undefined'){                    document.getElementById('imagenCategoria').value = "<?php echo $imagen; ?>";                   $("#nombreCategoria").val(sessionStorage.getItem('nombreCategoria'));                   sessionStorage.clear();                }            }            //FUNCION PARA COMPROBAR LOS CAMPOS DEL FORMULARIO            function subirFormulario(){                 if(comprobar()){                    if(comprobarImagen()){                    document.getElementById("form1").submit();                    }                }                        }//FUNCION PARA SUBIR SIN IMAGEN            function subirFormularioSinImagen(){                                     document.getElementById("form1").submit();            }            //FUNCION PARA COMPROBAR LOS VALORES DE LOS CAMPOS            function comprobar(){                var validez = true;                if($("#nombreCategoria").val() === ''){                $("#nombreCategoria").css({'border-width': '3px', 'border-color': '#a94442'});                validez = false;                }else{                    $("#nombreCategoria").css({'border-width': '2px', 'border-color': 'initial'});                }                if($("#categoria").val() === ''){                $("#categoria").css({'border-width': '3px', 'border-color': '#a94442'});                validez = false;                }else{                    $("#categoria").css({'border-width': '2px', 'border-color': 'white'});                }                if($("#subcategoria").val() == null){                $("#subcategoria").css({'border-width': '3px', 'border-color': '#a94442'});                validez = false;                }else{                    $("#subcategoria").css({'border-width': '2px', 'border-color': 'white'});                }                                if($("#precioVenta").val() === ''){                $("#precioVenta").css({'border-width': '3px', 'border-color': '#a94442'});                validez = false;                }else{                    $("#precioVenta").css({'border-width': '2px', 'border-color': 'white'});                }                if($("#existenciasProducto").val() === ''){                $("#existenciasProducto").css({'border-width': '3px', 'border-color': '#a94442'});                validez = false;                }else{                    $("#existenciasProducto").css({'border-width': '2px', 'border-color': 'white'});                }                return validez;            }//FUNCION PARA COMPROBAR LA IMAGEN            function comprobarImagen(){                var validez = true;                if($("#imagenCategoria").val() === ''){                    $("#id1").css("display", "block");                    validez = false;                                }                return validez;            }            //FUNCION PARA MOSTRAR TOAST            function toast(text) {                $('.toast').text(text);                $('.toast').fadeIn(400).delay(2000).fadeOut(400);            }                    </script>    <link rel="shortcut icon" href="../imagenes/comanderFavicon.ico"></head>    <body>        <header class="w3-card-4 w3-theme header w3-padding-large" style="height: 100px;">            <div class ="w3-margin" style="float: left;"><img src="../imagenes/mano.png" class="w3-round-small" alt="Norway" style="width:40px;height: 40px;"></div>            <div class="w3-xxxlarge" style="width: 50%;float: left;">COMANDER</div>            <div class="w3-xlarge w3-right" style="margin-top: 20px;margin-right: 10px;"><?php echo $headerTitle; ?></div>        </header>        <div class="subcontenedor">            <div class="sidebar1 w3-card-4 w3-theme-l1 w3-large">                <div class="w3-xlarge w3-margin-top w3-margin-bottom w3-padding-left"><?php echo $sidevarTitle; ?></div><?php include("../includes/BotoneraAdmin.php"); ?>            </div>                     <div class="content">                       <h1 class="w3-center"><?php echo $modifYProductTag; ?></h1>                    <div class="contenido">                        <p class=" w3-center w3-medium"><?php echo $modifyProductDescription; ?></p>                                                 <div class="contenidoFormulario w3-card-8 w3-large w3-text-white w3-grey">                                 <form action="<?php echo $editFormAction; ?>" method="post" name="form1" id="form1">                                    <table width="334" align="center">                                         <br>                                    <tr valign="baseline">                                        <td nowrap="nowrap" width="55" align="right"><?php echo $nameTag; ?></td>                                        <td width="240">                                            <input style= "height:40px;" name="nombreProducto" type="text" value="<?php echo recuperarString($row_consultaProducto['id_string']); ?>" size="34" maxlength="26" />                                        </td>                                        <tr valign="baseline">                                            <td nowrap="nowrap" align="right"><?php echo $imageTag; ?></td>                                            <td>                                                <input class="w3-large" style= "height:40px;width:175px;" type="text" name="imagenProducto" id="imagenCategoria" value="<?php echo $row_consultaProducto['imagenProducto']; ?>"/>                                                <input style="height:38px; margin-bottom:5px" class="w3-btn w3-light-grey w3-border w3-card-8 w3-text-grey w3-large" type="button" name="button" id="button" onclick="document.getElementById('id16').style.display = 'block';" value="<?php echo $chooseImageButton; ?>"/>                                            </td>                                        </tr>                                        <tr valign="baseline">                                            <td nowrap="nowrap" align="right"><?php echo $categoryTag; ?></td>                                            <td>                                                <select style= "height:40px;width:175px;" id="categoria" name="idCategoriaProducto">                                                   <option selected value="<?php echo $row_consultaProducto['idCategoriaProducto'] ?>"><?php echo recuperarString(ObtenerNombreCategoria($row_consultaProducto['idCategoriaProducto'])); ?></option>                                                 </select>                                            </td>                                        </tr>                                                <tr valign="baseline">                                            <td nowrap="nowrap" align="right"><?php echo $subcategoryTag; ?></td>                                                <td>                                                    <select style= "height:40px;width:175px;" id="subcategoria" name="idSubcategoriaProducto">                                                        <option selected value="<?php echo $row_consultaProducto['idSubcategoriaProducto'] ?>"><?php echo recuperarString(ObtenerNombreSubcategoria($row_consultaProducto['idSubcategoriaProducto'])); ?></option>                                                    </select>                                                </td>                                        </tr>                                               <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>                                        <script type="text/javascript">                                            $( "#categoria" ).click(function(){                                                    $( "#categoria" ).load( "cargaCategorias.php" );                                                    $( "#categoria" ).change(function(){                                                        var id = $("#categoria").val();                                                        $.get("cargaSubcategorias.php",{param_id:id})                                                        .done(function (data){                                                                $("#subcategoria").html(data);                                                                                                           });                                                });                                            });                                        </script>                                                                                <tr valign="baseline">                                            <td nowrap="nowrap" align="right"><?php echo $sendArea; ?></td>                                            <td>                                                <select id="#envioProducto" style= "height:40px;width:175px;" name="envioProducto">                                                    <option value="<?php echo $row_consultaProducto['envioProducto'];?>"><?php echo recuperarString(ObtenerNombreZona($row_consultaProducto['envioProducto']));  ?></option>                                                    <?php do{?>                                                               <option value="<?php echo $RowConsultaZonas['idZona'];?>"><?php echo recuperarString($RowConsultaZonas['id_string']);  ?></option>                                                                <?php }  while ($RowConsultaZonas = mysqli_fetch_assoc($query_zonas)); ?>                                                                                                    </select>                                            </td>                                        </tr>                                                <tr valign="baseline">                                            <td nowrap="nowrap" align="right"><?php echo $stateTag; ?></td>                                            <td>                                                <select style= "height:40px;width:175px;" name="estadoProducto">                                                    <option value="1" <?php if (!(strcmp(1, htmlentities($row_consultaProducto['estadoProducto'], ENT_COMPAT, 'utf-8')))) {echo "selected=\"selected\"";} ?>>Disponible</option>                                                    <option value="0" <?php if (!(strcmp(0, htmlentities($row_consultaProducto['estadoProducto'], ENT_COMPAT, 'utf-8')))) {echo "selected=\"selected\"";} ?>>No disponible</option>                                                </select>                                            </td>                                        </tr>                                        <tr valign="baseline">                                            <td width="47" align="right" nowrap="nowrap"><?php echo $salePriceTag; ?></td>                                            <td>                                                <input style= "height:40px;width:175px;" name="precioVentaProducto" type="text" value="<?php echo htmlentities($row_consultaProducto['precioVentaProducto'], ENT_COMPAT, 'utf-8'); ?>" size="40" maxlength="40" />                                            </td>                                        </tr>                                        <tr valign="baseline">                                            <td width="47" align="right" nowrap="nowrap"><?php echo $purchasePrice; ?></td>                                            <td>                                                <input style= "height:40px;width:175px;" name="precioCompraProducto" type="text" value="<?php echo $row_consultaProducto['precioCompraProducto']; ?>" size="40" maxlength="40" />                                            </td>                                        </tr>                                        <tr valign="baseline">                                            <td width="47" align="right" nowrap="nowrap"><?php echo $stockTag; ?></td>                                            <td>                                                <input style= "height:40px;width:175px;" name="stockProducto" type="text" value="<?php echo htmlentities($row_consultaProducto['stockProducto'], ENT_COMPAT, 'utf-8'); ?>" size="40" maxlength="40" />                                            </td>                                        </tr>                                        <tr valign="middle">                                            <td nowrap="nowrap" align="right"><?php echo $descriptionTag; ?></td>                                            <td>                                                <label for="textarea"></label>                                                <textarea name="descripcionProducto" style="height:60px" id="textarea" cols="35" rows="5"><?php echo $row_consultaProducto['descripcionProducto'] ?></textarea>                                            </td>                                        </tr>                                        <tr valign="middle">                                            <td nowrap="nowrap" align="right"><?php echo $allergensTag; ?></td>                                            <td>                                                <label for="textarea"></label>                                                <textarea name="alergenosProducto" id="textarea" cols="35" rows="5" style="height:60px" placeholder="<?php echo $exampleAllergensDescription; ?>"></textarea>                                            </td>                                        </tr>                                        <tr valign="middle">                                            <td nowrap="nowrap" align="right"><?php echo $nutritionalInformationTag; ?></td>                                            <td>                                                <label for="textarea"></label>                                                <textarea name="nutricionalProducto" id="textarea" cols="35" rows="5" style="height:60px" placeholder="<?php echo $exampleNutritionalDescription; ?>"></textarea>                                            </td>                                        </tr>                                                                                                                  </table>                                    <input type="hidden" name="MM_update" value="form1" />                                                                    </form>                                <div class="w3-center">                                    <button class="w3-center w3-btn w3-light-grey w3-border w3-card-8 w3-text-grey w3-large" onclick="subirFormulario();"> <?php echo $modifyProductButton; ?></button>                                </div>                                <br>                            </div>                                                    </div>                        <div id="id16" class="w3-modal w3-center " style="display: none;padding-left: 230px;">                        <div class="w3-container w3-section w3-light-grey w3-card-8 w3-large w3-text-dark-grey" style='width:70%;margin:0 auto;'>                            <span onclick="document.getElementById('id16').style.display = 'none';" class="w3-closebtn">&times;</span>                            <br>                            <form id="subirImg" name="subirImg" enctype="multipart/form-data" method="post" action="">                                <input type="hidden" name="MAX_FILE_SIZE" value="2000000" />                                <input class="w3-large" style="float: left;" type="file" name="imagen" id="imagen" />                                <input class="w3-large"  type="submit" name="subirBtn" id="subirBtn" value="<?php echo $upImageButton; ?>" />                                <br><br>                            </form>                        </div>                        </div>                </div>                <div class="footer"></div>            </div>         </div>    </body></html><?phpmysqli_free_result($consultaProducto);?>