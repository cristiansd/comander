<?phprequire_once('../includes/funcionesAdmin.php');include '../includes/phpqrcode/qrlib.php';  if (!isset($_SESSION)) {  session_start();}$MM_authorizedUsers = "1,2,3";$MM_donotCheckaccess = "false";$MM_restrictGoTo = "accesoUsuarioAdmin.php";$editFormAction = $_SERVER['PHP_SELF'];if (isset($_SERVER['QUERY_STRING'])) {  $editFormAction .= "?" . htmlentities($_SERVER['QUERY_STRING']);}if (!((isset($_SESSION['MM_Username'])) && (isAuthorized("",$MM_authorizedUsers, $_SESSION['MM_Username'], $_SESSION['MM_UserGroup'])))) {     $MM_qsChar = "?";  $MM_referrer = $_SERVER['PHP_SELF'];  if (strpos($MM_restrictGoTo, "?")) $MM_qsChar = "&";  if (isset($_SERVER['QUERY_STRING']) && strlen($_SERVER['QUERY_STRING']) > 0)   $MM_referrer .= "?" . $_SERVER['QUERY_STRING'];  $MM_restrictGoTo = $MM_restrictGoTo. $MM_qsChar . "accesscheck=" . urlencode($MM_referrer);  header("Location: ". $MM_restrictGoTo);   exit;}if ((isset($_POST["MM_insert"])) && ($_POST["MM_insert"] == "form1")) {        //DECLARAMOS LAS VARIABLES DE CONEXION A LA BD    mysqli_select_db($conexionComanderAdmin, $database_conexionComanderAdmin);        //GENERAMOS LA INSERCION DE LA MESA    $insertSQL = sprintf("INSERT INTO mesas (nombreMesa) VALUES (%s)",    GetSQLValueString($_POST['nombreMesa'], "text"));      $Result1 = mysqli_query($conexionComanderAdmin, $insertSQL) or die(mysqli__error($conexionComanderAdmin));        //REALIZAMOS CONSULTA PARA RECUPERAR EL ID DE LA MESA    $consulta_mesa = "SELECT idMesa FROM mesas ORDER BY idMesa DESC";    $consulta_mesa_query = mysqli_query($conexionComanderAdmin, $consulta_mesa) or die (mysqli_error($conexionComanderAdmin));    $row_consulta_mesa = mysqli_fetch_array($consulta_mesa_query);    $mesa = $row_consulta_mesa['0'];        //ASIGNAMOS LOS VALORES NECESARIOS A VARIABLES    $establecimiento = $_COOKIE['establecimiento'];    $tipo = "image/png";        //CREAMOS EL CODIGO QR DE LA MESA    $file = '../archivos/ImagenesQr/codigoQRmesaAdmin'.$establecimiento.$mesa.'.png';     $data = "establecimiento=$establecimiento&mesa=$mesa";     $size = 3;     $level = QR_ECLEVEL_H;     QRcode::png($data, $file, $level, $size);        //CODIFICAMOS LA IMAGEN EN BINARIO PARA SUBIRLA A LA BASE DE DATOS    $fd = fopen ($file, "r");    while(!feof($fd)) {        $buffer = fread($fd, 2048);        $imagen = addslashes($buffer);    }        //SUBIMOS LA IMAGEN A LA TABLA MESAS    $query_images = "INSERT INTO imagenes (imagen, tipo_imagen) VALUES ('$imagen', '$tipo')";            mysqli_query($conexionComanderAdmin, $query_images) or die (mysqli_error($conexionComanderAdmin)) ;        //ELIMINAMOS LA IMAGEN TEMPORAL    unlink($file);        //RECUPERAMOS EL ID DE LA IMAGEN     $consulta_mesa = "SELECT id FROM imagenes ORDER BY id DESC";    $consulta_mesa_query = mysqli_query($conexionComanderAdmin, $consulta_mesa) or die (mysqli_error($conexionComanderAdmin));    $rows_cosulta_mesa = mysqli_fetch_array($consulta_mesa_query);    $imagen = $rows_cosulta_mesa['0'];        //ACUTIALIZAMOS EL REGISTRO DE LA MESA CON EL ID DE LA IMAGEN     $consulta_tabla_mesas = "UPDATE mesas SET id_imagen='$imagen' WHERE idMesa = '$mesa'";    $consulta_tabla_mesas_query = mysqli_query($conexionComanderAdmin, $consulta_tabla_mesas) or die (mysqli_error($conexionComanderAdmin));      $insertGoTo = "administracionMesasAdmin.php";  if (isset($_SERVER['QUERY_STRING'])) {    $insertGoTo .= (strpos($insertGoTo, '?')) ? "&" : "?";    $insertGoTo .= $_SERVER['QUERY_STRING'];  }  header(sprintf("Location: %s", $insertGoTo));}$MesasRows=ConsultaNoRowsBD("mesas", "", "");$Mesas=ConsultaNoBD("mesas", "", "");?><!DOCTYPE html><html>    <head>        <meta charset="utf-8">        <link rel="stylesheet" href="../estilos/w3.css">        <link rel="stylesheet" href="../estilos/w3-theme-indigo.css">        <script type="text/javascript" src="../envCam/jquery-mobile/jquery.js"></script>        <link href="../estilos/admin.css" rel="stylesheet" type="text/css" />        <link href="../estilos/w3-theme-indigo.css" rel="stylesheet" type="text/css" />        <title><?php echo $titleSheet; ?></title>        <style type="text/css"></style>        <script type="text/javascript">            var height;            var width;            var nombreCategoria;            $(document).ready(function () {                height = $(window).height();                width = $(window).width();                var styleSidevar1 = "height:" + (height - 100) + "px;";                var styleFormulario = "margin-left:" + ((width - 500 - 240) / 2) + "px";                //$(".content").attr("style", styleSidevar1);                //$(".subcontenedor").attr("style", styleSidevar1);                if(height > $(".sidebar1").height()){                $(".sidebar1").attr("style", styleSidevar1);                                }                if($(".subcontenedor").height()>$(".sidebar1").height()){                    $(".sidebar1").attr("style", "height:" + $(".subcontenedor").height() + "px;");                                                }                $(".contenidoFormulario").attr("style", styleFormulario);                setImage();                $("#subirBtn").click(function(){                    nombreCategoria = $("#nombreCategoria").val();                    sessionStorage.setItem('nombreCategoria', nombreCategoria);                });            });//FUNCION PARA ELIMINAR EQITUETA CATEGORIA            function eliminarEtiqueta() {                $("#categoriaElemento").remove();            }            //FUNCION ASIGNAR VALOR A EL INPUT IMAGEN            function setImage(){                var image = "<?php echo $imagen; ?>";                if(typeof image !== 'undefined'){                    document.getElementById('imagenCategoria').value = "<?php echo $imagen; ?>";                   $("#nombreCategoria").val(sessionStorage.getItem('nombreCategoria'));                   sessionStorage.clear();                }            }        </script>    <link rel="shortcut icon" href="../imagenes/comanderFavicon.ico"></head>    <body>        <header class="w3-card-4 w3-theme header w3-padding-large" style="height: 100px;">            <div class ="w3-margin" style="float: left;"><img src="../imagenes/mano.png" class="w3-round-small" alt="Norway" style="width:40px;height: 40px;"></div>            <div class="w3-xxxlarge" style="width: 50%;float: left;">COMANDER</div>            <div class="w3-xlarge w3-right" style="margin-top: 20px;margin-right: 10px;"><?php echo $headerTitle; ?></div>        </header>        <div class="subcontenedor">            <div class="sidebar1 w3-card-4 w3-theme-l1 w3-large">                <div class="w3-xlarge w3-margin-top w3-margin-bottom w3-padding-left"><?php echo $sidevarTitle; ?></div><?php include("../includes/BotoneraAdmin.php"); ?>            </div>                 <div class="content">                   <h1 class=" w3-center"><p><?php echo $addTableTittle;?></p></h1>                <div class="contenido">                        <p class=" w3-center w3-medium"><?php echo $addTableDescription; ?></p>                    <br>                    <div class="contenidoFormulario w3-card-8 w3-large w3-text-white w3-grey">                            <form action="<?php echo $editFormAction; ?>" method="post" name="form1" id="form1">                                <table align="center">                                    <br>                                    <tr valign="baseline">                                        <td nowrap="nowrap" align="right"><?php echo $nameTableTag; ?></td>                                        <td><input type="text" name="nombreMesa" value="" size="32" /></td>                                    </tr>                                    <tr valign="baseline">                                        <td nowrap="nowrap" align="right">&nbsp;</td>                                        <td style="padding-top: 10px;padding-bottom: 10px;">                                            <input class="w3-btn w3-light-grey w3-border w3-card-8 w3-text-grey w3-large" type="submit" value="Insertar mesa" />                                        </td>                                    </tr>                                </table>                                <input type="hidden" name="MM_insert" value="form1" />                            </form>                        </div>                    </div>                </div>            <div class="footer"></div>        </div>     </div></body></html>