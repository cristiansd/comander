<?phprequire_once('../Connections/conexionComanderEnvCam.php');require_once('../includes/funcionesEnvCam.php');if (!isset($_SESSION)) {    session_start();}$MM_authorizedUsers = "3,2,1";$MM_donotCheckaccess = "false";include '../includes/restriccionCam.php';$idUsuario = recuperaUsuario($_SESSION['MM_Username']);mysqli_select_db($comcon, $database_comcon);//MESAS$query_Mesas = "SELECT * FROM mesas";$Mesas = mysqli_query($comcon, $query_Mesas) or die(mysqli_connect_error());$row_Mesas = mysqli_fetch_assoc($Mesas);$totalRows_Mesas = mysqli_num_rows($Mesas);//FIN MESAS//LISTA DE PREPARADOS$query_recogeIdPedido = "SELECT * FROM comandas WHERE estadoCerradoComanda=0 AND estadoPreparadoComanda=1 AND cantidadEntregaComanda=0 ORDER BY horaComandaPreparada DESC";$recogeIdPedido = mysqli_query($comcon, $query_recogeIdPedido) or die(mysqli_connect_error());$row_recogeIdPedido = mysqli_fetch_assoc($recogeIdPedido);$totalRows_recogeIdPedido = mysqli_num_rows($recogeIdPedido);//FIN LISTA DE PREPARADOS?><!DOCTYPE html><html>    <head>        <meta charset="utf-8">        <meta name='HandheldFriendly' content='true' />        <meta name='viewport' content='width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no;' />        <title>Ver categorias</title>        <link rel="stylesheet" href="../estilos/w3.css">        <link rel="stylesheet" href="../estilos/w3-theme-indigo.css">        <link rel="stylesheet" href="..\font-awesome-4.7.0\css\font-awesome.min.css">        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">        <script type="text/javascript" src="../envCam/js/location.js"></script>        <script type="text/javascript" src="js/numpad.js"></script>        <script type="text/javascript" src="../W3Data/w3data.js"></script>        <script type="text/javascript" src="../envCam/jquery-mobile/jquery.js"></script>                <link rel="stylesheet" href="lib/css/jkeyboard.css">        <script src="lib/js/jkeyboard.js"></script>                <style type="text/css">            .userselect {                -webkit-user-select: none;  /* Chrome all / Safari all */                -moz-user-select: none;     /* Firefox all */                -ms-user-select: none;      /* IE 10+ */                  }                        .toast {                width:200px;                height:20px;                height:auto;                position:absolute;                left:50%;                margin-left:-100px;                bottom:150px;                background-color: #383838;                color: #F0F0F0;                font-family: Calibri;                font-size: 20px;                padding:10px;                text-align:center;                border-radius: 5px;                -webkit-box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);                -moz-box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);                box-shadow: 0px 0px 24px -1px rgba(56, 56, 56, 1);            }            #resultInput {                 display: block;                width: 100%;                height: 15%;                margin: 0 auto;                  padding-right: 10px;                 background-color: #ccc;                 border: none;                 text-align: right;                border-radius: 3px;                -webkit-border-radius: 3px;                -moz-border-radius: 3px;                box-shadow:inset 0 0 5px #000000;	                -moz-box-shadow:inset 0 0 5px #000000;                -webkit-box-shadow:inset 0 0 5px #000000;            }            #basic {                 margin: 0 auto;                 padding: 0;                border-collapse: collapse;                height: 85%;            }            #basic td {                background-color: #3f51b5;                border: 5px solid #3f51b5;                padding: 0;                width: 18%;                height: 18%;            }            #basic button {                display: block;                font-size: 18px;                width: 100%;                height: 100%;	                padding: 0;                text-align: center;                vertical-align: middle;                line-height: 100%;                color: #000;                border: none;                background-color: #f1f1f1;	                border: 1px solid #666;                border-radius: 5px;                -webkit-border-radius: 5px;                -moz-border-radius: 5px;            }            #basic button:hover {                font-size: 24px;                color: #333;                cursor: pointer;                border: 1px solid #f1f1f1;            }            #basic button:active {                background: none;                background-color: #ccc;                color: #000;            }        </style>           <script type="text/javascript">                        var mesaGlobal = "";            var pedidoGlobal = "";            if (typeof(idPedido) !== 'undefined'){                idPedido = "";            }                        function inicializaTeclado(){                $('#keyboard').jkeyboard({                  // 'english', 'azeri', or 'russian'                  layout: "english",                  input: $('#textocomentario')                });            }                    function compruebaNotify(){                $.ajax({                    type: "POST",	                            url: "compruebaNotificaciones.php",                    async: true,                    success: function (data) {                        cadena = data.replace(/^\s+|\s+$/gm, '');                        if (cadena === 'SI') {                            $("#btnnotificaciones").css("background-color","#ffeb3b");                            $("#btnnotificaciones").css("color","#000");                        }else{                            $("#btnnotificaciones").css("background-color","#3f51b5");                            $("#btnnotificaciones").css("color","#fff");                        }                    }                });            }                        $(window).load(function () {                $('.userselect').height($(window).height());                Calc.init();            });                        function recarga() {                $('#panelseleccion').load('seleccionTpv.php');                setInterval(function () {                    compruebaNotify();                    $("#pant").load(location.href + " #pant");                    $("#panellista").load(location.href + " #panellista");                    $("#divinferior").load(location.href + " #divinferior");                }, 2000);            }                        function changeColor(x){                x.style.background="#C6D5FF";            }            function getParameterByName(name) {                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");                var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),                        results = regex.exec(location.search);                return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));            }                        function irA(url){                $('#panelseleccion').load(url);            }                        function abrirPedidos() {                var mesa = {'idMesa':mesaGlobal};                $.ajax({                    type: "POST",                    url: "../envCam/consultaPedidos.php",                    data: mesa,                    success: function (data) {                        objeto = JSON.parse(data);                        w3DisplayData("Item", objeto);                        document.getElementById('id06').style.display = 'block';                                            }                });            }                        function realiza(accion) {                switch (accion) {                    case 0:                        document.getElementById('id02').style.display = 'block';                        break;                    case 1:                        document.getElementById('id04').style.display = 'block';                        break;                    case 2:                        document.getElementById('id05').style.display = 'block';                        break;                    case 3:                        irAPedido();                        break;                    case 4:                        document.getElementById('id01').style.display = 'block';                        break;                    case 5:                        document.getElementById('id03').style.display = 'block';                        break;                }            }            function irAPedido() {                var mesa = {'idMesa': mesaGlobal};                $.ajax({                    type: "GET",                    url: "../envCam/recuperaPedido.php",                    data: mesa,                    success: function (idPedido2) {                        $("#progress").css("display", "none");                        if (idPedido2 === "MULT") {                            abrirPedidos();                        } else {                            $("#progress").css("display","none");                            pedidoGlobal = idPedido2;                            $("#panelseleccion").load('listaTpv.php?idMesa=' + mesaGlobal + '&idPedido=' + idPedido2);                        }                    }                });            }                        function abrePedido(m, p){                $("#panelseleccion").load('listaTpv.php?idMesa=' + m + '&idPedido=' + p);            }                        function crearPedido() {                var crea = {'idMesa': mesaGlobal};                $.ajax({                    type: "GET",                    url: "../envCam/crearPedido.php",                    data: crea,                    success: function (Pedido) {                        pedidoGlobal = Pedido;                        document.getElementById('id02').style.display = 'none';                        $('.toast').text('Pedido creado');                        $('.toast').fadeIn(400).delay(2000).fadeOut(400);                        $("#pant").load(location.href + " #pant");                        $("#panelseleccion").load('verCategoriasTpv.php?idPedido=' + pedidoGlobal + '&idMesa=' + mesaGlobal);                    }                });            }                        function asignarPedido() {                $("#progress").css("display", "block");                var asigna = {'idMesa': mesaGlobal};                $.ajax({                    type: "GET",                    url: "../envCam/asignarPedido.php",                    data: asigna,                    success: function (data) {                        borrarNotificacion();                        irAPedido();                        document.getElementById('id05').style.display = 'none';                        $("#pant").load(location.href + " #pant");                    }                });            }            function borrarNotificacion() {                var borrar = {'idMesa': mesaGlobal};                $.ajax({                    type: "POST",                    async: true,                    url: "borrarNotificacion.php",                    data: borrar,                    success: function (data) {                    }                });            }                        function liberarMesa() {                document.getElementById('id03').style.display = 'none';                var mesa = {'idMesa': mesaGlobal};                $.ajax({                    type: "POST",                    url: "../envCam/liberarMesa.php",                    data: mesa,                    success: function (data) {                        $('.toast').text('Mesa liberada');                        $('.toast').fadeIn(400).delay(2000).fadeOut(400);                        document.getElementById('id01').style.display = 'none';                        $("#pant").load(location.href + " #pant");                    }                });            }        </script>    </head>    <body class="w3-light-grey" onload="recarga();">        <!--<div class="w3-padding w3-display-middle" id="progress"><img src="page-loader.gif" width="100px" height="100px"></div>-->        <div class="userselect">            <header class="w3-card-4 w3-theme header" style="height: 10%;margin-bottom: 8px;padding-left: 12px;">                <div class ="w3-margin" style="float: left;"><img src="../imagenes/mano.png" class="w3-round-small" alt="Norway" style="width:40px;height: 40px;"></div>                <div class="w3-xxxlarge" style="width: 50%;float: left;">COMANDER</div>                <div class="w3-xlarge w3-right" style="margin-top: 20px;margin-right: 10px;padding-right: 12px;">PUNTO DE VENTA</div>            </header>            <div id="divsuperior" style="height: 50%;">                <div id="pant">                     <div class="w3-border w3-border-black" style="float: left;width: 50%;height: 554px;">                        <div class="w3-row" style="">                            <div class="w3-row">                                <div class="w3-col w3-green w3-center" style="width:50%">                                    MESA LIBRE                                </div>                                <div class="w3-col w3-orange w3-center" style="width:50%">                                    PEDIDO PROPIO                                </div>                            </div>                            <div class="w3-row">                                <div class="w3-col w3-yellow w3-center" style="width:50%">                                    MESA ESPERANDO                                </div>                                <div class="w3-col w3-red w3-center" style="width:50%">                                    PEDIDO AJENO                                </div>                            </div>                        </div>                        <div class="w3-padding-small" style="text-align: center;overflow-y: scroll;height: 455px;">                            <?php                            do {                                if ($row_Mesas['estadoMesa'] == 0 && $row_Mesas['peticionMesa'] == 0 && $row_Mesas['ocupacionMesa'] == 0) {                                    $urlMesa = 'mesa_verde.png';                                    $accion = 0;                                }                                if ($row_Mesas['estadoMesa'] == 0 && $row_Mesas['peticionMesa'] == 0 && $row_Mesas['ocupacionMesa'] == 1) {                                    $urlMesa = 'mesa_verde_tachada.png';                                    $accion = 1;                                }                                if ($row_Mesas['estadoMesa'] == 0 && $row_Mesas['peticionMesa'] == 1) {                                    $urlMesa = 'mesa_amarilla.png';                                    $accion = 2;                                }                                if ($row_Mesas['estadoMesa'] == 1) {                                    $urlMesa = 'mesa_naranja.png';                                    $accion = 3;                                }                                if ($row_Mesas['estadoMesa'] == 1 && todoCompleto($row_Mesas['idMesa'])) {                                    $urlMesa = 'mesa_naranja_tachada.png';                                    $accion = 4;                                }                                /*if ($row_Mesas['estadoMesa'] == 1 && $row_Mesas['idUsuarioMesa'] != $idUsuario) {                                    $urlMesa = 'mesa_roja.png';                                    $accion = 5;                                }                                if ($row_Mesas['estadoMesa'] == 1 && $row_Mesas['idUsuarioMesa'] != $idUsuario && todoCompleto($row_Mesas['idMesa'])) {                                    $urlMesa = 'mesa_roja_tachada.png';                                    $accion = 6;                                }*/                                ?>                                <div style="cursor:pointer;float: left;background-image: url(../imagenes/EnvCamImages/<?php echo $urlMesa; ?>);background-position: center;background-repeat: no-repeat;width: 14%; height: 100px;"                                     onclick="mesaGlobal =<?php echo $row_Mesas['idMesa']; ?>;                                                 realiza(<?php echo $accion; ?>)">                                    <?php echo $row_Mesas['nombreMesa']; ?>                                </div>                            <?php } while ($row_Mesas = mysqli_fetch_assoc($Mesas)); ?>                        </div>                        <div style="">                            <button class="w3-btn w3-indigo w3-large w3-center w3-padding-large" style="width: 100%;" onclick="document.getElementById('modal01').style.display = 'block';" id="btnmapa">MOSTRAR MAPA</button>                        </div>                    </div>                </div>                <div class="w3-border w3-border-black" style="float: left;width: 25%;min-height: 550px;">                    <div id="cont" style="height: 550px;">                        <input class="w3-xlarge" id="resultInput" type="text" value="" />                        <table id="basic" cellpadding="0" cellspacing="0">	                            <tr>                                <td><button data-keypress="47" data-char="&#247;" onmousedown="Calc.append(this);                                        return false;">&#247;</button></td>                                <td><button data-keypress="42" data-char="&#215;" onmousedown="Calc.append(this);                                        return false;">&#215;</button></td>                                <td><button data-keypress="45" data-char="&#45;" onmousedown="Calc.append(this);                                        return false;">&#151;</button></td>                                <td><button data-keypress="43" data-char="&#43;" onmousedown="Calc.append(this);                                        return false;">&#43;</button></td>                            </tr>                            <tr>                                <td><button data-keypress="55" data-char="7" onmousedown="Calc.append(this); return false;">7</button></td>                                <td><button data-keypress="56" data-char="8" onmousedown="Calc.append(this);                                        return false;">8</button></td>                                <td><button data-keypress="57" data-char="9" onmousedown="Calc.append(this); return false;">9</button></td>                                <td><button data-keydown="8" onmousedown="Calc.backspace();                                        return false;">&laquo;</button></td>                            </tr>                            <tr>                                <td><button data-keypress="52" data-char="4" onmousedown="Calc.append(this);                                        return false;">4</button></td>                                <td><button data-keypress="53" data-char="5" onmousedown="Calc.append(this);                                        return false;">5</button></td>                                <td><button data-keypress="54" data-char="6" onmousedown="Calc.append(this);                                        return false;">6</button></td>                                <td><button data-keydown="46" onmousedown="Calc.clear();                                        return false;">C</button></td>                            </tr>                            <tr>                                <td><button data-keypress="49" data-char="1" onmousedown="Calc.append(this);                                        return false;">1</button></td>                                <td><button data-keypress="50" data-char="2" onmousedown="Calc.append(this); return false;">2</button></td>                                <td><button data-keypress="51" data-char="3" onmousedown="Calc.append(this);                                        return false;">3</button></td>                                <td rowspan="2"><button data-keydown="13" onmousedown="Calc.equals();                                        return false;">=</button></td>                            </tr>                            <tr>                                <td><button data-keypress="46" data-char="." onmousedown="Calc.append(this);                                        return false;">.</button></td>                                <td colspan="2"><button data-keypress="48" data-char="0" onmousedown="Calc.append(this);                                        return false;">0</button></td>                            </tr>                        </table>                    </div>                </div>                <div class="w3-border w3-border-black" style="min-height: 554px;overflow-y: scroll;" id="panelseleccion">                    ...Cargando panel                </div>            </div>                        <div id="divinferior" style="width: 100%;height: 20%;overflow-y: scroll;">                <div class="w3-left" style="clear: left;width: 100%;" id="panellista">                    <div class="" style="margin-top: 5px;">                        <?php if ($totalRows_recogeIdPedido > 0){?>                        <table class="w3-table w3-striped w3-bordered w3-border">                            <thead>                                <tr class="w3-theme-l2">                                    <th width="2%" align="center">CANTIDAD</th>                                    <th width="30%" align="center">&nbsp;PRODUCTO</th>                                    <th width="2%" align="center">MESA</th>                                    <th width="30%" align="center">&nbsp;COMENTARIO</th>                                    <th width="6%" align="center">TIPO</th>                                    <th width="15%" align="center">&nbsp;CAMARERO&nbsp;</th>                                    <th width="10%" align="center">&nbsp;HORA&nbsp;</th>                                </tr>                            </thead>                        <?php                         do {?>                             <tr class="w3-hover-theme" onclick="abrePedido(<?php echo $row_recogeIdPedido['idMesaComanda'] ?>, <?php echo $row_recogeIdPedido['idPedidoComanda'] ?>);">                            <td align="center"><?php echo $row_recogeIdPedido['cantidadPedidaComanda'] ?>&nbsp;</td>                            <td align="center">&nbsp;<?php echo recuperaNombreProducto($row_recogeIdPedido['idProductoComanda']) ?></td>                            <td align="center"><?php echo recuperaNombreMesa($row_recogeIdPedido['idMesaComanda']) ?></td>                            <td align="center">&nbsp;<?php echo $row_recogeIdPedido['comentarioComanda'] ?></td>                            <td align="center"><?php if ($row_recogeIdPedido['idMenuProductosComanda'] != NULL){ echo "MENU"; }else{ echo "CARTA";} ?></td>                            <td align="center"><?php if ($row_recogeIdPedido['idUsuarioComanda'] != NULL){echo strtoupper(recuperaNickUsuario($row_recogeIdPedido['idUsuarioComanda']));} ?>&nbsp;</td>                            <td align="center"><?php echo $row_recogeIdPedido['horaComandaPreparada']; ?>&nbsp;</td>                          </tr>                        <?php } while ($row_recogeIdPedido = mysqli_fetch_assoc($recogeIdPedido));?>                        </table>                        <?php }else{?>                        <div class="w3-theme-l2 w3-card-8 w3-center w3-xlarge" style="width: 100%;margin-top: 60px;">NO EXISTEN PEDIDOS PREPARADOS EN ESTE MOMENTO</div>                        <?php }?>                    </div>                </div>            </div>                        <div id="id01" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-container w3-section w3-yellow w3-center" style="width: 40%;margin-left: 30%;">                    <span onclick="document.getElementById('id01').style.display = 'none';" class="w3-closebtn">&times;</span>                    <h3>¡ATENCIÓN!</h3>                    <div><b>EN ESTA MESA YA ESTÁ TODO ENTREGADO Y PAGADO</b></div>                    <div class="w3-margin-top w3-margin-bottom w3-center">                        <button class="w3-btn w3-indigo w3-large" style="width:60%;height: 80px;margin-left: 5px;" id="" onclick="liberarMesa();">LIBERAR MESA</button>                    </div>                </div>               </div>            <div id="id02" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-container w3-section w3-yellow w3-center" style="width: 40%;margin-left: 30%;">                    <span onclick="document.getElementById('id02').style.display = 'none';" class="w3-closebtn">&times;</span>                    <h3>¡ATENCIÓN!</h3>                    <div><b>SE CREARÁ UN NUEVO PEDIDO Y SE LE ASIGNARÁ ESTA MESA<br>¿ESTÁS SEGURO?</b></div>                    <div class="w3-margin-top w3-margin-bottom w3-center">                        <button class="w3-btn w3-indigo w3-xlarge" style="width:30%;height: 80px;margin-right: 20px;"  id="" onclick="crearPedido();">SI</button>                        <button class="w3-btn w3-indigo w3-xlarge" style="width:30%;height: 80px;margin-left: 20px;" id="" onclick="document.getElementById('id02').style.display = 'none';">NO</button>                    </div>                </div>               </div>            <div id="id03" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-container w3-section w3-yellow w3-center" style="width: 40%;margin-left: 30%;">                    <span onclick="document.getElementById('id03').style.display = 'none';" class="w3-closebtn">&times;</span>                    <h3>¡ATENCIÓN!</h3>                    <div>ESTA MESA ESTA ASIGNADA A OTRO CAMARERO</div>                    <div class="w3-margin-top w3-margin-bottom w3-center">                        <button class="w3-btn w3-indigo w3-small" style="width:60%;margin-left: 5px;" id="" onclick="document.getElementById('id03').style.display = 'none';">CERRAR</button>                    </div>                </div>               </div>            <div id="id04" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-container w3-section w3-yellow w3-center" style="width: 40%;margin-left: 30%;">                    <span onclick="document.getElementById('id04').style.display = 'none';" class="w3-closebtn">&times;</span>                    <h3>¡ATENCIÓN!</h3>                    <div>ESTA MESA ESTA RECIEN OCUPADA. SE REALIZARA AUTOPEDIDO</div>                    <div class="w3-margin-top w3-margin-bottom w3-center">                        <button class="w3-btn w3-indigo w3-small" style="width:60%;margin-left: 5px;" id="" onclick="document.getElementById('id04').style.display = 'none';">CERRAR</button>                    </div>                </div>               </div>            <div id="id05" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-container w3-section w3-yellow w3-center" style="width: 40%;margin-left: 30%;">                    <span onclick="document.getElementById('id05').style.display = 'none';" class="w3-closebtn">&times;</span>                    <h3>¡ATENCIÓN!</h3>                    <div><b>ACEPTARAS ESTE AUTOPEDIDO Y SE TE ASIGNARA ESTA MESA<br>¿ESTÁS SEGURO?</b></div>                    <div class="w3-margin-top w3-margin-bottom w3-center">                        <button class="w3-btn w3-indigo w3-large" style="width:30%;height: 80px;margin-right: 20px;"  id="" onclick="asignarPedido();">SI</button>                        <button class="w3-btn w3-indigo w3-large" style="width:30%;height: 80px;margin-left: 20px;" id="" onclick="document.getElementById('id05').style.display = 'none';">NO</button>                    </div>                </div>               </div>            <div id="modal01" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <span onclick="document.getElementById('modal01').style.display = 'none';"  class="w3-text-white w3-closebtn w3-container w3-padding-16 w3-display-topright">&times;</span>                <div class="w3-animate-zoom" style="margin-left: 15%;">                    <img src="../imagenes/Mapa/mapa_2.jpg" style="width:80%">                </div>            </div>            <div id="id06" class="w3-modal" style="padding-left: 10%;padding-right: 10%;">                <div class="w3-modal-content w3-card-8 w3-round-medium"  style="width: 30%;margin-left: 30%;">                    <header class="w3-container w3-theme-l2">                        <span onclick="document.getElementById('id06').style.display = 'none'"                              class="w3-closebtn">&times;</span>                        <h4>SELECCIONAR PEDIDO</h4>                    </header>                    <div class="w3-container w3-large w3-margin" style="height: 240px;overflow: scroll;">                        <ul id="Item" class="w3-ul w3-card-4">                            <li class="w3-hover-light-blue" w3-repeat="clientes" id="{{idPedido}}" value="{{idPedido}}" onclick="pedidoGlobal = {{idPedido}};document.getElementById('id06').style.display = 'none';irA('listaTpv.php?idMesa=' + mesaGlobal + '&idPedido=' + {{idPedido}});">PEDIDO Nº {{idPedido}}</li>                        </ul>                    </div>                    <footer class="w3-container w3-theme-l2" style="height: 3px;"></footer>                </div>            </div>            </div>                    <div id="keyboard" style="position: fixed;top: 100px;left: 150px;background: #144766;display: none;width: 60%;padding-top: 30px;padding-bottom: 30px;">        </div>        <footer class="w3-container w3-bottom w3-padding-0">            <button class="w3-indigo w3-small w3-center w3-margin-top w3-padding-small" style="width: 100%;">COMANDER TPV</button>        </footer>    </body></html>