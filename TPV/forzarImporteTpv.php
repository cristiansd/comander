<?phprequire_once('../Connections/conexionComanderEnvCam.php');require_once('../includes/funcionesEnvCam.php');if (!isset($_SESSION)) {    session_start();}$MM_authorizedUsers = "3,2,1";$MM_donotCheckaccess = "false";include '../includes/restriccionCam.php';if (isset($_GET['idPedido'])){    $idPedido = $_GET['idPedido'];    $idMesa = $_GET['idMesa'];    //$ref = $_GET['ref'];    $ref = 1;    switch ($ref) {        case 1:            $destino = '../envCam/cobrarPedido.php';            break;        case 2:            $destino = '../envCam/cobrarPedidoTemp.php';            break;    }}?><!DOCTYPE html><html>    <head>        <script type="text/javascript">            var idPedido = <?php echo $idPedido ?>;            var precioGlobal = '';            var mesa = <?php echo $idMesa ?>;            var nombreMesa = <?php echo recuperaNombreMesa($idMesa) ?>;                        $("#keyboard").css("display","none");            $("#progress").css("display","none");            $("#textonav").html("PEDIDO");            $("#divmesa").html('Mesa ' + nombreMesa);            $("#divpedido").html('Pedido: ' + idPedido);            $("#divfecha").html('Fecha: ' + fecha());            $("#divprecio").html('0.00' + ' &euro;');                        function irAtras(){                irA('listaTpv.php?idPedido='+idPedido);            }                        function fecha(){                var hoy = new Date();                var dd = hoy.getDate();                var mm = hoy.getMonth()+1; //hoy es 0!                var yyyy = hoy.getFullYear();                if(dd<10) {                    dd='0'+dd                }                 if(mm<10) {                    mm='0'+mm                }                 hoy = dd+'/'+mm+'/'+yyyy;                return hoy;            }            function actualizaPrecio() {                var actualiza = {'idPedido': idPedido, 'check': 1};                $.ajax({                    type: "POST",                    url: "../envCam/actualizaPrecio.php",                    data: actualiza,                    success: function (data) {                        precioGlobal = data;                        var low = '';                        if (!isNaN(data)) {                            low = parseFloat(data).toFixed(2);                            if (isNaN(low)) {                                low = '0.00';                            }                            $("#divprecio").html(low + ' &euro;');                        } else {                            $('.toast').text('Error al actualizar');                            $('.toast').fadeIn(400).delay(2000).fadeOut(400);                        }                    }                });            }                        function cerrarCobro(){                $("#pant").load(location.href + " #pant");                irA('seleccionTpv.php');            }                        function validar(){                precioModificado = document.getElementById('resultInput').value;                var low = parseFloat(precioModificado).toFixed(2);                document.getElementById("first").value = low;                document.getElementById('resultInput').value="";            }            $(document).ready(function () {                document.getElementById("resultInput").value="";                $('#forzar').click(function () {                    if (isNaN(document.getElementById("first").value)){                        //document.getElementById("resultInput").value="";                        //document.getElementById("first").value="";                        $('.toast').text("NO ES UN NUMERO");                        $('.toast').fadeIn(400).delay(2000).fadeOut(400);                    }else{                        var precioForzado = document.getElementById("first").value;                        var forzado = {'idPedido': idPedido, 'precioForzado': precioForzado};                        $.ajax({                            type: "POST",                            url: "fuerzaPrecio.php",                            data: forzado,                            success: function (data) {                                var cadena = data.replace(/^\s+|\s+$/gm, '');                                if (cadena === "OK") {                                    var paga = {'idPedido': idPedido, 'precioTotal': precioForzado};                                    $.ajax({                                        type: "POST",                                        url: "<?php echo $destino ?>",                                        data: paga,                                        success: function (data) {                                            var cadena2 = data.replace(/^\s+|\s+$/gm, '');                                            if (cadena2 === 'OK') {                                                $("#progress").css("display","none");                                                $('.toast').text('Se imprimio el ticket y se valid√≥ el cobro correctamente');                                                $('.toast').fadeIn(400).delay(2000).fadeOut(400);                                                $("#pant").load(location.href + " #pant");                                                document.getElementById("resultInput").value="";                                                document.getElementById("first").value="";                                                document.getElementById('id01').style.display = 'block';                                            }else{                                                $('.toast').text('Error al validar el pago');                                                $('.toast').fadeIn(400).delay(2000).fadeOut(400);                                            }                                        }                                    });                                } else {                                    $('.toast').text(data+'Error al forzar precio');                                    $('.toast').fadeIn(400).delay(2000).fadeOut(400);                                }                            }                        });                    }                });            });        </script>    </head>    <body class="w3-light-grey">        <div class="w3-padding w3-display-middle" id="progress"><img src="page-loader.gif" width="100px" height="100px"></div>        <div class="userselect">            <div class="w3-container w3-card-4 w3-theme w3-padding-4" id="cap">                <div class="w3-center" style="">                    <div class="w3-margin-top" style="float: left;">                        <i class="material-icons w3-xlarge w3-left" onclick="irAtras();">&#xE5C4;</i>                    </div>                    <div class="center" style="">                        <div id="divmesa" class="w3-xlarge"></div>                        <div id="divpedido" class="w3-medium"></div>                    </div>                </div>            </div>            <div style="height: 380px;" id="">                <div class="w3-center w3-xlarge w3-padding-large">                    <p><label>UTILICE EL TECLADO NUMERICO DE LA IZQUIERDA Y PRESIONE EL BOTON TICKET</label>                        <input class="w3-margin-top w3-input w3-border" style="text-align: center;" id="first" name="first"></p>                    <!--<button class="w3-btn w3-green" onclick="validar();">VALIDAR</button>-->                </div>            </div>            <div class="w3-container w3-padding-0" style="">                <div class="w3-row w3-small w3-padding-small">                    <div id="divfecha" class="w3-large"></div>                    AL IMPRIMIR EL TICKET SE VALIDARA EL COBRO                </div>                <div class="w3-row" style="margin-bottom: 3px;">                    <div class="w3-center" style="width: 50%;float: left;">                        <button class="w3-btn w3-theme w3-xlarge" style="width: 98%;" id="forzar">TICKET</button>                    </div>                    <div class="w3-center" style="width: 50%;float: right;">                        <button class="w3-btn w3-theme w3-xlarge" style="width: 98%;" id="" onclick="irAtras();">VOLVER</button>                    </div>                </div>            </div>                        <div id="id01" class="w3-modal">                <div class="w3-modal-content w3-card-8 w3-round-medium" style="top: 80px;width: 40%;margin-left: 30%;">                    <header class="w3-container w3-theme-l2">                        <span onclick="document.getElementById('id01').style.display = 'none'"                              class="w3-closebtn">&times;</span>                        <h4>PEDIDO COBRADO</h4>                    </header>                    <div class="w3-container w3-large w3-margin w3-center">                        EL COBRO SE HA REALIZADO CORRECTAMENTE Y SE HA VALIDADO EL PEDIDO                        <div class="w3-margin-top w3-margin-bottom">                            <button class="w3-btn w3-xlarge w3-theme" style="width: 60%;height: 90px;" id="" onclick="cerrarCobro();">ACEPTAR</button>                        </div>                    </div>                </div>            </div>                        <div class='toast' style='display:none'>TOAST</div>        </div>    </body></html><?phpmysqli_free_result($RegComanda);mysqli_free_result($RegPedido);?>